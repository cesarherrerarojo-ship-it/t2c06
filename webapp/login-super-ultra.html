<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Super Ultra - Anti ERR_ABORTED</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff2d55 0%, #ff5e3a 50%, #ff9500 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .super-ultra-container {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(255, 45, 85, 0.3);
            overflow: hidden;
            width: 100%;
            max-width: 1600px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 800px;
        }

        .login-section {
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
        }

        .debug-section {
            padding: 30px;
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            overflow-y: auto;
            max-height: 800px;
        }

        .super-ultra-title {
            font-size: 36px;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(255, 45, 85, 0.5);
            background: linear-gradient(45deg, #ff2d55, #ff9500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .super-ultra-subtitle {
            font-size: 18px;
            margin-bottom: 40px;
            text-align: center;
            opacity: 0.9;
            color: #ff9500;
        }

        .anti-aborted-status {
            background: rgba(255, 45, 85, 0.1);
            border: 1px solid rgba(255, 45, 85, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .method-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #ff2d55;
            transition: all 0.3s ease;
        }

        .method-item:hover {
            background: rgba(255, 45, 85, 0.1);
            transform: translateY(-2px);
        }

        .method-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .method-name {
            font-weight: 600;
            font-size: 14px;
            color: #ff9500;
        }

        .method-indicator {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending { background: #444; color: #fff; }
        .status-testing { background: #ff9500; color: #000; }
        .status-success { background: #00ff00; color: #000; }
        .status-error { background: #ff0040; color: #fff; }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ff9500;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ff2d55;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff9500;
            box-shadow: 0 0 15px rgba(255, 149, 0, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .super-ultra-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .super-ultra-btn.primary {
            background: linear-gradient(135deg, #ff2d55 0%, #ff5e3a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 45, 85, 0.4);
        }

        .super-ultra-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 45, 85, 0.6);
        }

        .super-ultra-btn.secondary {
            background: linear-gradient(135deg, #ff9500 0%, #ffb347 100%);
            color: #000;
            margin-top: 15px;
        }

        .super-ultra-btn.secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 149, 0, 0.6);
        }

        .super-ultra-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .method-used {
            background: linear-gradient(135deg, #00ff00 0%, #32cd32 100%);
            color: #000;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ff0040 0%, #cc0000 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
        }

        .debug-header {
            font-size: 18px;
            margin-bottom: 20px;
            color: #ff2d55;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 45, 85, 0.5);
        }

        .debug-log {
            margin: 2px 0;
            padding: 3px 0;
            font-size: 11px;
        }

        .debug-log.success { color: #00ff00; }
        .debug-log.error { color: #ff0040; font-weight: bold; }
        .debug-log.warning { color: #ff9500; }
        .debug-log.info { color: #00ffff; }

        @media (max-width: 768px) {
            .super-ultra-container {
                grid-template-columns: 1fr;
                max-width: 500px;
            }
            
            .login-section {
                padding: 30px;
            }
            
            .debug-section {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="super-ultra-container">
        <div class="login-section">
            <h1 class="super-ultra-title">üõ°Ô∏è SUPER ULTRA LOGIN</h1>
            <p class="super-ultra-subtitle">Anti ERR_ABORTED System - 10 M√©todos de Bypass</p>
            
            <div class="anti-aborted-status">
                <h3 style="margin-bottom: 15px; color: #ff2d55;">üéØ Sistema Anti-ERR_ABORTED</h3>
                <p style="font-size: 13px; line-height: 1.5; opacity: 0.9;">
                    Este sistema utiliza <strong>10 m√©todos diferentes</strong> para bypass del error net::ERR_ABORTED, 
                    incluyendo proxies CORS, JSONP extendido, formularios con iframe, XHR anti-abort, 
                    y t√©cnicas avanzadas de bypass.
                </p>
            </div>

            <div class="method-grid" id="methodGrid">
                <!-- Los m√©todos se generar√°n din√°micamente -->
            </div>

            <form id="superUltraLoginForm">
                <div class="form-group">
                    <label for="superUltraEmail">Correo Electr√≥nico</label>
                    <input type="email" id="superUltraEmail" name="email" required placeholder="tu@email.com">
                </div>
                
                <div class="form-group">
                    <label for="superUltraPassword">Contrase√±a</label>
                    <input type="password" id="superUltraPassword" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" class="super-ultra-btn primary" id="superUltraLoginBtn">
                    üöÄ INICIAR SESI√ìN SUPER ULTRA
                </button>
                
                <button type="button" class="super-ultra-btn secondary" id="superUltraTestBtn">
                    üß™ PROBAR 10 M√âTODOS ANTI-ERR_ABORTED
                </button>
            </form>
            
            <div id="methodUsed" class="method-used" style="display: none;"></div>
            <div id="errorMessage" class="error-message" style="display: none;"></div>
        </div>
        
        <div class="debug-section">
            <h3 class="debug-header">üñ•Ô∏è PANEL DE DEBUG SUPER ULTRA</h3>
            <div id="superUltraDebugLog"></div>
        </div>
    </div>

    <!-- Firebase config -->
    <script src="js/firebase-config.js"></script>
    <!-- Smart Redirect System V2 Mejorado -->
    <script src="js/smart-redirect-v2.js"></script>
    <!-- Auth Super Ultra -->
    <script src="js/firebase-auth-super-ultra.js"></script>
    
    <script>
        // Panel de debug super ultra
        function superUltraLog(message, type = 'info') {
            const debugLog = document.getElementById('superUltraDebugLog');
            const logEntry = document.createElement('div');
            logEntry.className = `debug-log ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateMethodStatus(methodId, status, message = '') {
            const indicator = document.getElementById(`indicator-${methodId}`);
            const card = document.getElementById(`method-${methodId}`);
            
            if (indicator) {
                indicator.className = `method-indicator status-${status}`;
                indicator.textContent = status === 'success' ? '‚úÖ √âXITO' : 
                                      status === 'error' ? '‚ùå FALL√ì' : 
                                      status === 'testing' ? 'üß™ PROBANDO' : '‚è≥ PENDIENTE';
            }
            
            if (card && message) {
                card.title = message;
            }
        }

        function showSuperUltraStatus(message, type = 'info') {
            const methodUsed = document.getElementById('methodUsed');
            const errorMessage = document.getElementById('errorMessage');
            
            if (type === 'success') {
                methodUsed.style.display = 'block';
                methodUsed.textContent = message;
                errorMessage.style.display = 'none';
            } else if (type === 'error') {
                errorMessage.style.display = 'block';
                errorMessage.textContent = message;
                methodUsed.style.display = 'none';
            } else {
                methodUsed.style.display = 'none';
                errorMessage.style.display = 'none';
            }
        }

        // Crear grid de m√©todos
        function createMethodGrid() {
            const methods = [
                { id: 'proxy-retry', name: 'Proxy con Reintentos', desc: 'M√∫ltiples proxies con reintentos' },
                { id: 'jsonp-extended', name: 'JSONP Extendido', desc: 'JSONP con timeout extendido' },
                { id: 'form-iframe', name: 'Form con Iframe', desc: 'Env√≠o por formulario e iframe' },
                { id: 'xhr-anti-abort', name: 'XHR Anti-Abort', desc: 'XMLHttpRequest con configuraci√≥n especial' },
                { id: 'fetch-manual-signal', name: 'Fetch Se√±al Manual', desc: 'Fetch con control manual de se√±al' },
                { id: 'image-beacon-tracking', name: 'Image Beacon', desc: 'T√©cnica de imagen beacon' },
                { id: 'postmessage-cross', name: 'PostMessage Cross', desc: 'Comunicaci√≥n cross-origin' },
                { id: 'websocket-tunnel', name: 'WebSocket Tunnel', desc: 'T√∫nel WebSocket' },
                { id: 'service-worker-intercept', name: 'Service Worker', desc: 'Interceptaci√≥n con Service Worker' },
                { id: 'local-proxy-sim', name: 'Local Proxy Sim', desc: 'Simulaci√≥n de proxy local' }
            ];

            const grid = document.getElementById('methodGrid');
            grid.innerHTML = '';

            methods.forEach(method => {
                const methodDiv = document.createElement('div');
                methodDiv.className = 'method-item';
                methodDiv.id = `method-${method.id}`;
                methodDiv.innerHTML = `
                    <div class="method-header">
                        <div class="method-name">${method.name}</div>
                        <div class="method-indicator status-pending" id="indicator-${method.id}">‚è≥ PENDIENTE</div>
                    </div>
                    <div style="font-size: 11px; color: #aaa; line-height: 1.3;">${method.desc}</div>
                `;
                grid.appendChild(methodDiv);
            });
        }

        // Test de conectividad super ultra
        document.getElementById('superUltraTestBtn').addEventListener('click', async function() {
            const testBtn = this;
            testBtn.disabled = true;
            testBtn.textContent = 'üß™ PROBANDO 10 M√âTODOS...';
            
            // Verificar que authSuperUltra est√© inicializado
            if (!authSuperUltra) {
                superUltraLog('‚ùå Error: Sistema super ultra no inicializado', 'error');
                showSuperUltraStatus('‚ùå Error: Sistema no inicializado', 'error');
                testBtn.disabled = false;
                testBtn.textContent = 'üß™ PROBAR 10 M√âTODOS ANTI-ERR_ABORTED';
                return;
            }
            
            // Resetear estados
            ['proxy-retry', 'jsonp-extended', 'form-iframe', 'xhr-anti-abort', 
             'fetch-manual-signal', 'image-beacon-tracking', 'postmessage-cross', 
             'websocket-tunnel', 'service-worker-intercept', 'local-proxy-sim'].forEach(method => {
                updateMethodStatus(method, 'pending');
            });
            
            superUltraLog('üß™ Iniciando pruebas anti-ERR_ABORTED...', 'info');
            showSuperUltraStatus('üß™ Probando 10 m√©todos anti-ERR_ABORTED...', 'info');
            
            try {
                const results = await authSuperUltra.testConnectivity();
                
                superUltraLog('üìä Resultados de conectividad anti-ERR_ABORTED:', 'info');
                
                // Actualizar estados
                Object.entries(results).forEach(([method, success]) => {
                    updateMethodStatus(method, success ? 'success' : 'error', 
                        success ? 'M√©todo funcionando' : 'M√©todo fall√≥');
                    superUltraLog(`   ${method}: ${success ? '‚úÖ' : '‚ùå'}`, success ? 'success' : 'error');
                });
                
                const workingMethods = Object.values(results).filter(v => v === true).length;
                superUltraLog(`üìà ${workingMethods}/10 m√©todos anti-ERR_ABORTED funcionando`, 
                    workingMethods > 0 ? 'success' : 'warning');
                
                showSuperUltraStatus(`üß™ Conectividad probada: ${workingMethods}/10 m√©todos funcionan`, 
                    workingMethods > 0 ? 'info' : 'error');
                
            } catch (error) {
                superUltraLog(`‚ùå Error en prueba anti-ERR_ABORTED: ${error.message}`, 'error');
                showSuperUltraStatus(`‚ùå Error en prueba: ${error.message}`, 'error');
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'üß™ PROBAR 10 M√âTODOS ANTI-ERR_ABORTED';
            }
        });

        // Manejo del formulario super ultra
        document.getElementById('superUltraLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('superUltraEmail').value;
            const password = document.getElementById('superUltraPassword').value;
            const loginBtn = document.getElementById('superUltraLoginBtn');
            
            // Verificar que authSuperUltra est√© inicializado
            if (!authSuperUltra) {
                superUltraLog('‚ùå Error: Sistema super ultra no inicializado', 'error');
                showSuperUltraStatus('‚ùå Error: Sistema no inicializado - revisa la configuraci√≥n', 'error');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'üöÄ INICIANDO SESI√ìN SUPER ULTRA...';
            
            superUltraLog(`üöÄ Iniciando autenticaci√≥n super ultra anti-ERR_ABORTED con: ${email}`, 'info');
            showSuperUltraStatus('üöÄ Iniciando autenticaci√≥n super ultra anti-ERR_ABORTED...', 'info');
            
            try {
                const result = await loginSuperUltra(email, password);
                
                if (result.success) {
                    superUltraLog(`‚úÖ Login super ultra anti-ERR_ABORTED exitoso con m√©todo: ${result.method}`, 'success');
                    showSuperUltraStatus(`‚úÖ Login exitoso! M√©todo usado: ${result.method}`, 'success');
                    
                    // Mostrar m√©todo usado
                    const methodUsed = document.getElementById('methodUsed');
                    methodUsed.innerHTML = `
                        <div style="font-size: 14px;">
                            ‚úÖ <strong>Autenticaci√≥n Exitosa</strong><br>
                            üì° M√©todo utilizado: <strong>${result.method}</strong><br>
                            üë§ Usuario: <strong>${result.user.email}</strong><br>
                            üîë Token: <strong>${result.user.idToken.substring(0, 20)}...</strong>
                        </div>
                    `;
                    
                    // Ejecutar redirecci√≥n inteligente despu√©s de 2 segundos
                    setTimeout(() => {
                        console.log('üéØ Ejecutando redirecci√≥n inteligente...');
                        console.log('üìß Email del usuario:', result.user.email);
                        console.log('üÜî UID del usuario:', result.user.uid);
                        console.log('üë§ DisplayName del usuario:', result.user.displayName);
                        
                        // Asegurar que el objeto usuario tenga la estructura correcta para smart redirect
                        const userForRedirect = {
                            email: result.user.email || '',
                            uid: result.user.uid || '',
                            displayName: result.user.displayName || '',
                            claims: result.user.claims || {}
                        };
                        
                        console.log('üéØ Objeto usuario para redirecci√≥n:', userForRedirect);
                        
                        if (typeof executeSmartRedirect === 'function') {
                            executeSmartRedirect(userForRedirect, 1000);
                        } else {
                            console.warn('‚ö†Ô∏è Smart redirect no disponible, usando redirecci√≥n simple...');
                            window.location.href = 'dashboard.html';
                        }
                    }, 2000);
                    
                } else {
                    superUltraLog(`‚ùå Login super ultra fall√≥: ${result.error}`, 'error');
                    showSuperUltraStatus(`‚ùå Login fall√≥: ${result.error}`, 'error');
                }
                
            } catch (error) {
                superUltraLog(`‚ùå Error en login super ultra: ${error.message}`, 'error');
                showSuperUltraStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'üöÄ INICIAR SESI√ìN SUPER ULTRA';
            }
        });

        // Inicializaci√≥n
        if (typeof FIREBASE_API_KEY !== 'undefined' && typeof FIREBASE_PROJECT_ID !== 'undefined') {
            authSuperUltra = new FirebaseAuthSuperUltra(FIREBASE_API_KEY, FIREBASE_PROJECT_ID);
            
            superUltraLog('üõ°Ô∏è Sistema super ultra anti-ERR_ABORTED iniciado', 'success');
            superUltraLog(`üì° API Key: ${FIREBASE_API_KEY.substring(0, 10)}...`, 'info');
            superUltraLog(`üèóÔ∏è Project ID: ${FIREBASE_PROJECT_ID}`, 'info');
            superUltraLog('üî• 10 m√©todos anti-ERR_ABORTED disponibles', 'info');
            
            // Crear grid de m√©todos
            createMethodGrid();
            
        } else {
            superUltraLog('‚ùå Error: Firebase configuration no est√° disponible', 'error');
            superUltraLog('üìã Aseg√∫rate de que firebase-config.js est√© cargado correctamente', 'warning');
        }
        
        // Verificar si hay usuario autenticado
        const savedUser = localStorage.getItem('authUser');
        if (savedUser) {
            superUltraLog('üë§ Usuario previamente autenticado encontrado', 'info');
            showSuperUltraStatus('üë§ Usuario autenticado previamente detectado', 'info');
        }
    </script>
</body>
</html>