<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Smart Redirect - DiagnÃ³stico de RedirecciÃ³n</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #fafafa;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        input, button {
            margin: 5px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ Test Smart Redirect System</h1>
        <p>DiagnÃ³stico completo del sistema de redirecciÃ³n inteligente</p>

        <div class="test-section">
            <h3>ğŸ“‹ Test 1: Simular Usuario Cesar</h3>
            <button onclick="testCesarUser()">Probar Usuario Cesar</button>
            <div id="cesar-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Test 2: Simular Usuario Admin</h3>
            <button onclick="testAdminUser()">Probar Usuario Admin</button>
            <div id="admin-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Test 3: Simular Usuario Search</h3>
            <button onclick="testSearchUser()">Probar Usuario Search</button>
            <div id="search-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Test 4: Usuario Personalizado</h3>
            <input type="text" id="custom-email" placeholder="Email de prueba">
            <input type="text" id="custom-uid" placeholder="UID de prueba">
            <input type="text" id="custom-displayname" placeholder="DisplayName de prueba">
            <button onclick="testCustomUser()">Probar Usuario Personalizado</button>
            <div id="custom-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Test 5: Verificar Rutas Existentes</h3>
            <button onclick="checkRoutes()">Verificar Rutas de RedirecciÃ³n</button>
            <div id="routes-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ Test 6: Consola de Debug</h3>
            <button onclick="clearConsole()">Limpiar Consola</button>
            <button onclick="enableDebug()">Activar Debug Detallado</button>
            <div id="debug-result" class="result" style="display:none;"></div>
        </div>
    </div>

    <!-- Cargar el sistema de redirecciÃ³n inteligente -->
    <script src="js/smart-redirect.js"></script>

    <script>
        // Funciones de test
        function testCesarUser() {
            console.log('ğŸ§ª Probando usuario Cesar...');
            
            const cesarUser = {
                email: 'cesar.rodriguez@example.com',
                uid: 'cesar_user_123',
                displayName: 'Cesar Rodriguez',
                claims: {}
            };

            smartRedirect.determineRedirect(cesarUser).then(route => {
                const result = document.getElementById('cesar-result');
                result.style.display = 'block';
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… Usuario Cesar detectado correctamente</strong><br>
                    <strong>Email:</strong> ${cesarUser.email}<br>
                    <strong>Ruta determinada:</strong> ${route}<br>
                    <strong>Expected:</strong> /webapp/cesar/dashboard.html
                `;
                
                if (route === '/webapp/cesar/dashboard.html') {
                    result.innerHTML += '<br><strong>âœ… Ruta correcta!</strong>';
                } else {
                    result.innerHTML += '<br><strong>âŒ Ruta incorrecta!</strong>';
                    result.className = 'result error';
                }
            });
        }

        function testAdminUser() {
            console.log('ğŸ§ª Probando usuario Admin...');
            
            const adminUser = {
                email: 'admin@example.com',
                uid: 'admin_user_123',
                displayName: 'Admin User',
                claims: { role: 'admin' }
            };

            smartRedirect.determineRedirect(adminUser).then(route => {
                const result = document.getElementById('admin-result');
                result.style.display = 'block';
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… Usuario Admin detectado correctamente</strong><br>
                    <strong>Email:</strong> ${adminUser.email}<br>
                    <strong>Ruta determinada:</strong> ${route}<br>
                    <strong>Expected:</strong> /webapp/admin/dashboard.html
                `;
                
                if (route === '/webapp/admin/dashboard.html') {
                    result.innerHTML += '<br><strong>âœ… Ruta correcta!</strong>';
                } else {
                    result.innerHTML += '<br><strong>âŒ Ruta incorrecta!</strong>';
                    result.className = 'result error';
                }
            });
        }

        function testSearchUser() {
            console.log('ğŸ§ª Probando usuario Search...');
            
            const searchUser = {
                email: 'search@example.com',
                uid: 'search_user_123',
                displayName: 'Search User',
                claims: { role: 'search' }
            };

            smartRedirect.determineRedirect(searchUser).then(route => {
                const result = document.getElementById('search-result');
                result.style.display = 'block';
                result.className = 'result success';
                result.innerHTML = `
                    <strong>âœ… Usuario Search detectado correctamente</strong><br>
                    <strong>Email:</strong> ${searchUser.email}<br>
                    <strong>Ruta determinada:</strong> ${route}<br>
                    <strong>Expected:</strong> /webapp/search/dashboard.html
                `;
                
                if (route === '/webapp/search/dashboard.html') {
                    result.innerHTML += '<br><strong>âœ… Ruta correcta!</strong>';
                } else {
                    result.innerHTML += '<br><strong>âŒ Ruta incorrecta!</strong>';
                    result.className = 'result error';
                }
            });
        }

        function testCustomUser() {
            const email = document.getElementById('custom-email').value;
            const uid = document.getElementById('custom-uid').value;
            const displayName = document.getElementById('custom-displayname').value;
            
            const customUser = {
                email: email,
                uid: uid,
                displayName: displayName,
                claims: {}
            };

            console.log('ğŸ§ª Probando usuario personalizado:', customUser);
            
            smartRedirect.determineRedirect(customUser).then(route => {
                const result = document.getElementById('custom-result');
                result.style.display = 'block';
                result.className = 'result info';
                result.innerHTML = `
                    <strong>ğŸ“‹ Resultado del test personalizado</strong><br>
                    <strong>Email:</strong> ${email || 'No proporcionado'}<br>
                    <strong>UID:</strong> ${uid || 'No proporcionado'}<br>
                    <strong>DisplayName:</strong> ${displayName || 'No proporcionado'}<br>
                    <strong>Ruta determinada:</strong> ${route}
                `;
            });
        }

        function checkRoutes() {
            const result = document.getElementById('routes-result');
            result.style.display = 'block';
            result.className = 'result info';
            
            let html = '<strong>ğŸ“ Rutas de redirecciÃ³n configuradas:</strong><br>';
            
            // Verificar si las rutas existen (simulado)
            const routes = {
                'Admin': '/webapp/admin/dashboard.html',
                'Cesar': '/webapp/cesar/dashboard.html',
                'Search': '/webapp/search/dashboard.html',
                'User': '/webapp/user/dashboard.html',
                'Default': '/webapp/index.html'
            };
            
            Object.entries(routes).forEach(([type, route]) => {
                html += `<br><strong>${type}:</strong> ${route}`;
            });
            
            result.innerHTML = html;
        }

        function clearConsole() {
            console.clear();
            const result = document.getElementById('debug-result');
            result.style.display = 'block';
            result.className = 'result success';
            result.innerHTML = 'âœ… Consola limpiada';
        }

        function enableDebug() {
            console.log('ğŸ” Debug detallado activado');
            console.log('ğŸ“Š Smart Redirect Manager:', smartRedirect);
            console.log('ğŸ¯ Redirect Routes:', smartRedirect.redirectRoutes);
            console.log('ğŸ“ Fallback Route:', smartRedirect.fallbackRoute);
            
            const result = document.getElementById('debug-result');
            result.style.display = 'block';
            result.className = 'result info';
            result.innerHTML = `
                <strong>ğŸ” Debug detallado activado</strong><br>
                Verifica la consola del navegador para mÃ¡s detalles.<br>
                <strong>Presiona F12 â†’ Consola/Console</strong>
            `;
        }

        // InicializaciÃ³n
        console.log('ğŸ¯ Test Smart Redirect System inicializado');
        console.log('ğŸ“Š Smart Redirect Manager disponible:', typeof smartRedirect !== 'undefined');
        
        if (typeof smartRedirect === 'undefined') {
            alert('âŒ Error: Smart Redirect System no estÃ¡ disponible. AsegÃºrate de que js/smart-redirect.js estÃ© cargado correctamente.');
        }
    </script>
</body>
</html>